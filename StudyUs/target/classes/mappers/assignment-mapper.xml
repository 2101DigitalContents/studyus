<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="assignmentMapper">
	<resultMap type="Assignment" id="assignmentResultMap">
		<id property="asNo" column="AS_NO"></id>
		<result property="grNo" column="GR_NO"></result> 
		<result property="asName" column="AS_NAME"></result>
		<result property="asContents" column="AS_CONTENTS"></result>
		<result property="asInsertDate" column="AS_INSERTDATE"></result>
		<result property="asDeadLine" column="AS_DEADLINE"></result>
		<result property="asMotherNo" column="AS_MOTHER_NO"></result>
		<result property="asStatus" column="AS_STATUS"></result>
	</resultMap>
	
	<resultMap type="AssignmentGroup" id="asGroupResultMap">
		<id property="grNo" column="GR_NO"></id>
		<result property="stNo" column="ST_NO"></result>
		<result property="grName" column="GR_NAME"></result>
		<result property="grInfo" column="GR_INFO"></result>
		<result property="grColor" column="GR_COLOR"></result>
		<result property="grStatus" column="GR_STATUS"></result>
	</resultMap>
	
	<!-- 과제 리스트 -->
	<select id="selectListCount" parameterType="_int" resultType="_int">
		SELECT COUNT(*) FROM ASSIGNMENT
		WHERE AS_MOTHER_NO IS NULL 
			<if test="value > 0">
			AND GR_NO = #{grNo}
			</if>
		AND AS_STATUS = 1
	</select>
	
	<select id="selectAllList" parameterType="_int" resultMap="assignmentResultMap">
		SELECT * FROM ASSIGNMENT
		WHERE AS_MOTHER_NO IS NULL
			<if test="value > 0">
			AND GR_NO = #{grNo}
			</if>
		AND AS_STATUS = 1
		ORDER BY AS_NO DESC
	</select>
	
	<select id="selectAllGroup" parameterType="_int" resultMap="asGroupResultMap">
		SELECT * FROM ASSIGNMENT_GROUP
		WHERE ST_NO = #{stNo}
		AND GR_STATUS = 1
		ORDER BY GR_NO DESC
	</select>
	
	<select id="selectOneGroup" parameterType="_int" resultMap="asGroupResultMap">
		SELECT * FROM ASSIGNMENT_GROUP
		WHERE GR_NO = #{grNo}
		AND GR_STATUS = 1
	</select>
	
	
	<!-- 디테일 -->
	<select id="selectOne" resultMap="assignmentResultMap">
		SELECT * FROM ASSIGNMENT
		WHERE AS_NO = #{asNo}
		AND AS_STATUS = 1
	</select>
	
	
	<!-- 과제 그룹 등록 -->
	<insert id="insertGroup" parameterType="AssignmentGroup">
		<selectKey resultType="int" keyProperty="grNo" order="BEFORE">
			SELECT SEQ_AS_GROUP.NEXTVAL FROM DUAL
		</selectKey>
		
		INSERT INTO ASSIGNMENT_GROUP VALUES (
			#{grNo}, #{stNo}, #{grName}, #{grInfo}, #{grColor}, DEFAULT
		)
	</insert>
	
	<!-- 과제 그룹 수정 -->
	<update id="updateGroup" parameterType="AssignmentGroup">
		UPDATE ASSIGNMENT_GROUP SET
		GR_NAME = #{grName}, GR_INFO = #{grInfo}, GR_COLOR = #{grColor}
		WHERE GR_NO = #{grNo}
		AND GR_STATUS = 1
	</update>
	
	<!-- 과제 그룹 삭제 -->
	<update id="deleteGroup" parameterType="AssignmentGroup">
		UPDATE ASSIGNMENT_GROUP SET
		GR_STATUS = 0
		WHERE GR_NO = #{grNo}
		AND GR_STATUS = 1
	</update>
	
	<!-- 과제 등록 -->
	<insert id="insertAssignment" parameterType="Assignment">
		INSERT INTO ASSIGNMENT VALUES (
			SEQ_ASSIGNMENT.NEXTVAL, #{grNo}, #{asName}, #{asContents}, TO_CHAR(SYSDATE), TO_CHAR(#{asDeadLine}), DEFAULT, DEFAULT 
		)
	</insert>
</mapper>